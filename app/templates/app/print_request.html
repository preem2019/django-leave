{% extends 'app/base_simple.html' %}
{% load static %}

{% block title %}
  พิมพ์คำขอ #{{ request.request_id }}
{% endblock %}

{% block extra_css %}
  <style>
    body {
      background-color: #fff; /* พื้นหลังสีขาวสำหรับพิมพ์ */
    }
    .print-container {
      max-width: 800px;
      margin: 2rem auto;
      border: 1px solid #ccc;
      padding: 2.5rem;
    }
    h2 {
      text-align: center;
      border-bottom: 2px solid #000;
      padding-bottom: 1rem;
      margin-bottom: 2rem;
    }
    .request-details,
    .approval-details {
      margin-bottom: 2rem;
    }
    .request-details p,
    .approval-details p {
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
    }
    .request-details strong,
    .approval-details strong {
      display: inline-block;
      min-width: 150px; /* จัดให้หัวข้อตรงกัน */
    }
    
    /* สไตล์สำหรับการพิมพ์ */
    @media print {
      body {
        background-color: #fff;
      }
      .print-container {
        border: none;
        margin: 0;
        padding: 0;
        max-width: 100%;
      }
      .btn-print {
        display: none; /* ซ่อนปุ่มพิมพ์เมื่อสั่งพิมพ์ */
      }
    }
  </style>
{% endblock %}

{% block content %}
  <div class="print-container">
    <h2>ใบขออนุญาตออกนอกสถานที่</h2>
    <h3 class="text-end mb-4">รหัสคำขอ (Request ID): #{{ request.request_id }}</h3>

    <div class="request-details">
      <h4>ข้อมูลคำขอ</h4>
      <hr />
      <p>
        <strong>ผู้ยื่นคำขอ:</strong> {{ request.employee.name }}
      </p>
      <p>
        <strong>แผนก:</strong> {{ request.employee.department.department_name }}
      </p>
      <p>
        <strong>วันที่ขออนุญาต:</strong> {{ request.leave_date|date:'d F Y' }}
      </p>
      <p>
        <strong>ระยะเวลา:</strong> {{ request.get_leave_duration_display }}
      </p>
      <p>
        <strong>เหตุผล:</strong> {{ request.reason|linebreaksbr }}
      </p>
      <p>
        <strong>สถานะ:</strong> <span class="fw-bold text-success">อนุมัติแล้ว (Approved)</span>
      </p>
    </div>

    <div class="approval-details">
      <h4>ประวัติการอนุมัติ</h4>
      <hr />
      {% for history in approval_history %}
        <p>
          <strong>ผู้อนุมัติ ({{ history.approver.role.role_name|capfirst }}):</strong>
          {{ history.approver.name }}
          <span class="text-success">(อนุมัติเมื่อ: {{ history.approval_date|date:'d/m/Y' }} {{ history.approval_time|date:'H:i' }})</span>
        </p>
      {% empty %}
        <p>ไม่พบประวัติการอนุมัติ</p>
      {% endfor %}
    </div>

    <div class="text-center mt-5">
      <p>....................................................</p>
      <p>(ลายเซ็นพนักงาน)</p>
      <p>วันที่: {{ request.leave_date|date:'d F Y' }}</p>
    </div>

    <div class="text-center mt-4">
      <button onclick="window.print();" class="btn btn-primary btn-lg btn-print"><i class="fas fa-print me-2"></i>พิมพ์เอกสารนี้</button>
    </div>
  </div>
{% endblock %}
